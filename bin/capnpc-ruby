#!/usr/bin/env ruby
# typed: strict

require "capnproto"
require "capnproto/generator"

begin
  buffer = CapnProto::IOBuffer.new(IO::Buffer.for(STDIN.read))
  message = CapnProto::StreamMessage.new(buffer)
  generator = CapnProto::Generator.new(message.root)
  generator.generate
rescue => e
  warn "#{e.class}: #{e.message}"
  e.backtrace.to_a.reject { |line| line.include?("/gems/sorbet-runtime-") }.each { |line| warn(line) }
end
